{"ast":null,"code":"var _jsxFileName = \"/Users/singyeongdeog/Documents/github_code/chatting-frontend/src/pages/ChatPage/ChatPage.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from 'react';\nimport queryString from 'query-string';\nimport \"./index.scss\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst ChatPage = ({\n  history,\n  location,\n  match\n}) => {\n  _s();\n\n  const params = queryString.parse(location.search);\n  const displayName = params.display_name;\n  const {\n    id\n  } = match.params;\n  const [ws, setWs] = useState();\n  const [readWs, setReadWs] = useState();\n  const [messages, setMessages] = useState([]);\n  const [newMsg, setNewMsg] = useState(undefined);\n  const [currMsg, setCurrMsg] = useState(\"\");\n  useEffect(() => {\n    setWs(new WebSocket(`ws://localhost:8000/chat?id=${id}&name=${displayName}`));\n    setReadWs(new WebSocket(`ws://localhost:8000/read?name=${displayName}`));\n  }, []);\n  useEffect(() => {\n    if (ws) {\n      ws.onmessage = evt => {\n        setNewMsg(JSON.parse(evt.data));\n      };\n    }\n  }, [ws]);\n  useEffect(() => {\n    if (newMsg) {\n      setMessages(messages.concat(newMsg));\n    }\n  }, [newMsg]);\n  useEffect(() => {\n    if (readWs) {\n      readWs.onmessage = evt => {\n        messages.map;\n      };\n    }\n  });\n\n  const handleChangeCurrMsg = msg => {\n    setCurrMsg(msg);\n  };\n\n  const handleClickSendMsg = () => {\n    if (currMsg === \"\") {\n      alert(\"메세지를 입력하세요\");\n      return;\n    }\n\n    ws === null || ws === void 0 ? void 0 : ws.send(currMsg);\n    setCurrMsg(\"\");\n  };\n\n  const handleKeyPress = key => {\n    if (key === \"Enter\") handleClickSendMsg();\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"chat-page-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"room-name-container\",\n      children: id\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chat-message-list-container\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chat-message-list-inner-container\",\n        children: messages.map(message => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `chat-message-form ${message.author === displayName ? \"me\" : \"other\"}`,\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"chat-message-inner-form\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: `chat-display-name`,\n              children: message.author\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 91,\n              columnNumber: 37\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"chat-message\",\n              children: message.message\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 94,\n              columnNumber: 37\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"chat-read\",\n              children: message.isRead ? \"읽음\" : \"안읽음\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 95,\n              columnNumber: 37\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 90,\n            columnNumber: 33\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 89,\n          columnNumber: 29\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chat-input-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        className: \"chat-input\",\n        value: currMsg,\n        onChange: e => handleChangeCurrMsg(e.target.value),\n        onKeyPress: e => handleKeyPress(e.key)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"chat-send-button\",\n        onClick: handleClickSendMsg,\n        children: \"send\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 81,\n    columnNumber: 9\n  }, this);\n};\n\n_s(ChatPage, \"DTUZYuN7SXy4ggNVc519MC5E8GY=\");\n\n_c = ChatPage;\nexport default ChatPage;\n\nvar _c;\n\n$RefreshReg$(_c, \"ChatPage\");","map":{"version":3,"sources":["/Users/singyeongdeog/Documents/github_code/chatting-frontend/src/pages/ChatPage/ChatPage.tsx"],"names":["React","useEffect","useState","queryString","ChatPage","history","location","match","params","parse","search","displayName","display_name","id","ws","setWs","readWs","setReadWs","messages","setMessages","newMsg","setNewMsg","undefined","currMsg","setCurrMsg","WebSocket","onmessage","evt","JSON","data","concat","map","handleChangeCurrMsg","msg","handleClickSendMsg","alert","send","handleKeyPress","key","message","author","isRead","e","target","value"],"mappings":"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","sourcesContent":["import React, {useEffect, useState} from 'react';\nimport {RouteComponentProps} from 'react-router';\nimport queryString from 'query-string';\nimport \"./index.scss\";\n\ntype Message = {\n    author: string,\n    message: string,\n    isRead: boolean,\n}\n\ntype Read = {\n    readUser: string,\n}\n\ntype PathVariables = {\n    id: number\n}\n\nconst ChatPage = ({ history, location, match }: RouteComponentProps) => {\n    const params = queryString.parse(location.search)\n    const displayName = params.display_name\n\n    const {id} = match.params as PathVariables\n\n    const [ws, setWs] = useState<WebSocket>();\n    const [readWs, setReadWs] = useState<WebSocket>();\n    const [messages, setMessages] = useState<Array<Message>>([]);\n    const [newMsg, setNewMsg] = useState<Message | undefined>(undefined);\n    const [currMsg, setCurrMsg] = useState(\"\");\n\n    useEffect(() => {\n        setWs(new WebSocket(`ws://localhost:8000/chat?id=${id}&name=${displayName}`))\n        setReadWs(new WebSocket(`ws://localhost:8000/read?name=${displayName}`))\n    }, [])\n\n    useEffect(() => {\n        if (ws) {\n            ws.onmessage = (evt) => {\n                setNewMsg(JSON.parse(evt.data))\n            };\n        }\n    }, [ws])\n\n    useEffect(() => {\n        if (newMsg) {\n            setMessages(\n                messages.concat(newMsg)\n            )\n        }\n    }, [newMsg])\n\n    useEffect(() => {\n        if(readWs) {\n            readWs.onmessage = (evt) => {\n                messages.map\n            };\n        }\n    })\n\n    const handleChangeCurrMsg = (msg: string) => {\n        setCurrMsg(msg)\n    }\n\n    const handleClickSendMsg = () => {\n        if (currMsg === \"\") {\n            alert(\"메세지를 입력하세요\")\n            return\n        }\n\n        ws?.send(currMsg)\n\n        setCurrMsg(\"\")\n    }\n\n    const handleKeyPress = (key: string) => {\n        if (key === \"Enter\") handleClickSendMsg()\n    }\n\n    return (\n        <div className={\"chat-page-container\"}>\n            <div className={\"room-name-container\"}>\n                {id}\n            </div>\n            <div className={\"chat-message-list-container\"}>\n                <div className={\"chat-message-list-inner-container\"}>\n                    {\n                        messages.map(message =>\n                            <div className={`chat-message-form ${message.author === displayName ? \"me\" : \"other\"}`}>\n                                <div className={\"chat-message-inner-form\"}>\n                                    <div className={`chat-display-name`}>\n                                        {message.author}\n                                    </div>\n                                    <div className={\"chat-message\"}>{message.message}</div>\n                                    <div className={\"chat-read\"}>\n                                        {message.isRead ? \"읽음\" : \"안읽음\"}\n                                    </div>\n                                </div>\n                            </div>\n                        )\n                    }\n                </div>\n            </div>\n            <div className={\"chat-input-container\"}>\n                <input\n                    className={\"chat-input\"}\n                    value={currMsg}\n                    onChange={(e) => handleChangeCurrMsg(e.target.value)}\n                    onKeyPress={e => handleKeyPress(e.key)}\n                />\n                <button className={\"chat-send-button\"} onClick={handleClickSendMsg}>send</button>\n            </div>\n        </div>\n    )\n}\n\nexport default ChatPage;"]},"metadata":{},"sourceType":"module"}